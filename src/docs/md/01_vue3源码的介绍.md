# 01_vue3源码的介绍

### 一、源码目录结构介绍

`vue3`整个的项目结构是通过`monorepo` (单一代码库) 的形式来组织的。  
所以说，`vue3`源码所有的模块都是在`packages`里面。

> mono意为单一，repo意为仓库，是一种将多个项目代码存储在一个仓库里的软件开发策略。

- - -

下面就开始介绍vue3源码的核心结构，由下图开始：

<img alt="vue3源码结构" src="https://iamzjt-1256754140.cos.ap-nanjing.myqcloud.com/images/202210222219255.png" width="888"/>

1、`compiler-sfc`: 用来解析单文件组件，也就是`.vue`文件，因为`.vue`文件不能直接被浏览器解析，一般会借助`webpack`的`vue-loader`把`template`、`script`、`style`部分抽离出来，然后各个模块运行各自的解析器，单独解析，而解析工作都是由`compiler-sfc`模块实现的。

2、`compiler-dom`: 是在`compiler-core`的基础上进行的封装，是处理`template`的，会把`template`编译成一个`render`函数。

3、`runtime-dom`: 它就是基于`runtime-core`创建的以浏览器为目标的运行时，包括对原生DOM API、属性、样式、事件等的管理。

4、`runtime-core`: 核心运行时，包括`虚拟DOM`的渲染器、组件实现和一些全局的JavaScript API。

5、`reactivity`: 数据驱动是`Vue.js`的核心概念之一，`响应式系统`是实现数据驱动的前提。`reactivity`包含了对响应式系统的实现，它是`runtime-core`包的依赖，也可是作为单独的包进行使用。


### 二、体验
先来体验一下`compiler-sfc`，此处借助`rollup`的打包功能
1. 创建一个目录，初始化进行包管理
```npm
// -y是生成默认package.json，省去回车
npm init -y
```

2. 首先安装一下`compiler-sfc`
```npm
npm i @vue/compiler-sfc -s
```

3. 再引入一下`rollup`及`vue`官方提供的一个插件: `roll-plugin-vue`
```npm
npm i rollup -D
npm i rollup-plugin-vue -D
```

4. 创建`App.vue`，`webstorm`的话，可以新建文件输入`vbase-css`，然后回车
<img src="https://iamzjt-1256754140.cos.ap-nanjing.myqcloud.com/images/202210222353164.png" width="888"/>

5. 加下来创建`roll.config.js`，进行`roll-up`的配置。
```javascript
import vue from 'rollup-plugin-vue';

export default {
  input: './App.vue',
  plugin: [vue()],
  output: {
    name: 'vue',
    format: 'es',
    file: 'lib/mini-vue.esm.js'
  }
}
```